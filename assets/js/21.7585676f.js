(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{375:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"循环依赖介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#循环依赖介绍"}},[t._v("#")]),t._v(" 循环依赖介绍")]),t._v(" "),a("p",[t._v("當兩個類相互依賴時，就會發生循環依賴。例如，A類需要B類，而B類也需要A類。在模塊之間以及提供程序之間的Nest中可能會產生循環依賴關係。儘管應盡可能避免循環依賴，但您不一定總是這樣做。在這種情況下，"),a("code",[t._v("Nest")]),t._v(" 可以通過兩種方式解決提供者之間的循環依賴關係。本章中，我們描述了使用作為一種技術的"),a("strong",[t._v("前向引用")]),t._v("，並使用 "),a("code",[t._v("ModuleRef")]),t._v(" 類從 "),a("code",[t._v("DI")]),t._v(" 容器中檢索提供者實例。")]),t._v(" "),a("p",[t._v("我們還描述了解決模塊之間循環依賴的問題。")]),t._v(" "),a("h2",{attrs:{id:"前向參考-前向引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前向參考-前向引用"}},[t._v("#")]),t._v(" 前向參考(前向引用)")]),t._v(" "),a("p",[t._v("前向引用使 "),a("code",[t._v("Nest")]),t._v(" 可以引用尚未使用 "),a("code",[t._v("forwardRef()")]),t._v(" 實用程序函數定義的類。例如，如果 "),a("code",[t._v("CatsService")]),t._v(" 和 "),a("code",[t._v("CommonService")]),t._v(" 相互依賴，則關係的兩端都可以使用 "),a("code",[t._v("@Inject()")]),t._v(" 和 "),a("code",[t._v("forwardRef()")]),t._v(" 實用程序來解決循環依賴關係。否則，"),a("code",[t._v("Nest")]),t._v(" 將不會實例化它們，因為所有基本元數據將不可用。示例：")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("官方示例")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("cats.service.ts\n")])])])]),t._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Injectable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CatsService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    @"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Inject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forwardRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" CommonService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" commonService"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" CommonService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[a("code",[t._v("forwardRef()")]),t._v(" 函數是從 "),a("code",[t._v("@nestjs/common")]),t._v(" 包導入的。")])]),t._v(" "),a("p",[t._v("这只是关系的一方面。現在讓我們對 "),a("code",[t._v("CommonService")]),t._v(" 做同樣的事情：")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("官方示例")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("common.service.ts\n")])])])]),t._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Injectable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommonService")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    @"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Inject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forwardRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" CatsService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" catsService"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" CatsService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("實例化的順序是不確定的。哪個構造函數首先調用也是不确定的。")])]),t._v(" "),a("h2",{attrs:{id:"moduleref-類的替代方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#moduleref-類的替代方法"}},[t._v("#")]),t._v(" "),a("code",[t._v("ModuleRef")]),t._v(" 類的替代方法")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("forwardRef()")]),t._v(" 的另一種方法是重構代碼，並使用 "),a("code",[t._v("ModuleRef")]),t._v(" 類在(否則)循環關係的一側檢索提供者。"),a("a",{attrs:{href:"https://docs.nestjs.com/fundamentals/module-ref",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),a("OutboundLink")],1),t._v("有關 "),a("code",[t._v("ModuleRef")]),t._v(" 實用程序類的更多信息。")]),t._v(" "),a("h2",{attrs:{id:"模塊前向參考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模塊前向參考"}},[t._v("#")]),t._v(" 模塊前向參考")]),t._v(" "),a("p",[t._v("為了解決模塊之間的循環依賴關係，請在模塊關聯的兩側使用相同的 "),a("code",[t._v("forwardRef()")]),t._v(" 實用程序函數。例如：")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("官方示例")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("common.module.ts\n")])])])]),t._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("@"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Module")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  imports"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forwardRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" CatsModule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommonModule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);